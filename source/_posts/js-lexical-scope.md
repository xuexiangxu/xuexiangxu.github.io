---
title: JavaScript çš„è¯æ³•ä½œç”¨åŸŸï¼ˆLexical Scopeï¼‰
date: 2025-02-06 09:59:19
tags: [JavaScript]
categories:
- [JavaScript]
---

### **1. ä»€ä¹ˆæ˜¯è¯æ³•ä½œç”¨åŸŸï¼Ÿ**
**è¯æ³•ä½œç”¨åŸŸï¼ˆLexical Scopeï¼‰** æ˜¯æŒ‡ **å˜é‡çš„ä½œç”¨åŸŸ** åœ¨ **ä»£ç ç¼–å†™æ—¶** å°±å·²ç»ç¡®å®šï¼Œè€Œä¸æ˜¯åœ¨ä»£ç è¿è¡Œæ—¶åŠ¨æ€å†³å®šçš„ã€‚

æ¢å¥è¯è¯´ï¼Œ**ä½œç”¨åŸŸç”±ä»£ç çš„åµŒå¥—ç»“æ„å†³å®šï¼Œè€Œä¸æ˜¯ç”±å‡½æ•°è°ƒç”¨æ–¹å¼å†³å®š**ã€‚

---

### **2. è¯æ³•ä½œç”¨åŸŸç¤ºä¾‹**
```javascript
function outer() {
  let a = "Hello";
  
  function inner() {
    console.log(a); // è¯æ³•ä½œç”¨åŸŸï¼šinner() å¯ä»¥è®¿é—® outer() é‡Œçš„å˜é‡ a
  }

  inner();
}

outer(); // è¾“å‡ºï¼šHello
```
ğŸ”¹ **è§£é‡Šï¼š**
- `inner()` æ˜¯ **å®šä¹‰åœ¨ `outer()` å†…éƒ¨** çš„ï¼Œæ‰€ä»¥ `inner()` å¯ä»¥è®¿é—® `outer()` ä½œç”¨åŸŸä¸­çš„å˜é‡ `a`ã€‚
- `a` åœ¨ `inner()` **å¤–éƒ¨ä½œç”¨åŸŸå®šä¹‰ï¼Œä½†ä»ç„¶å¯ä»¥è¢«è®¿é—®**ï¼Œè¿™å°±æ˜¯ **è¯æ³•ä½œç”¨åŸŸ**ã€‚

---

### **3. è¯æ³•ä½œç”¨åŸŸ vs åŠ¨æ€ä½œç”¨åŸŸ**
#### **ğŸ”¹ è¯æ³•ä½œç”¨åŸŸï¼ˆJavaScript ä½¿ç”¨ï¼‰**
ä½œç”¨åŸŸåœ¨ **å®šä¹‰æ—¶** ç¡®å®šï¼Œä¸ **è°ƒç”¨æ–¹å¼æ— å…³**ã€‚

```javascript
function outer() {
  let a = "Hello";

  function inner() {
    console.log(a);
  }

  return inner;
}

const fn = outer(); // `fn` ç°åœ¨æ˜¯ `inner` å‡½æ•°
fn(); // è¾“å‡ºï¼šHello
```
å³ä½¿ `fn` åœ¨ `outer()` æ‰§è¡Œå®Œåæ‰è°ƒç”¨ï¼Œå®ƒä»ç„¶èƒ½è®¿é—® `outer()` ä½œç”¨åŸŸä¸­çš„ `a`ï¼Œå› ä¸º **ä½œç”¨åŸŸåœ¨å®šä¹‰æ—¶å°±å·²ç¡®å®š**ã€‚

#### **ğŸ”¹ åŠ¨æ€ä½œç”¨åŸŸï¼ˆJavaScript ä¸ä½¿ç”¨ï¼‰**
ä¸€äº›ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚ Bashã€Perl æ—©æœŸç‰ˆæœ¬ï¼‰ä½¿ç”¨ **åŠ¨æ€ä½œç”¨åŸŸï¼ˆDynamic Scopeï¼‰**ï¼Œå³ **ä½œç”¨åŸŸå–å†³äºå‡½æ•°çš„è°ƒç”¨ä½ç½®**ï¼Œè€Œä¸æ˜¯å®šä¹‰ä½ç½®ã€‚ä½† **JavaScript ä¸ä½¿ç”¨åŠ¨æ€ä½œç”¨åŸŸ**ï¼Œè€Œæ˜¯ **è¯æ³•ä½œç”¨åŸŸ**ã€‚

---

### **4. åµŒå¥—ä½œç”¨åŸŸï¼ˆä½œç”¨åŸŸé“¾ï¼‰**
JavaScript çš„ä½œç”¨åŸŸæ˜¯ **åµŒå¥—** çš„ï¼Œæ¯ä¸ªå‡½æ•°å®šä¹‰æ—¶éƒ½ä¼šâ€œè®°ä½â€å®ƒåˆ›å»ºæ—¶çš„ä½œç”¨åŸŸã€‚

```javascript
const globalVar = "I am global";

function outer() {
  const outerVar = "I am outer";

  function inner() {
    const innerVar = "I am inner";
    console.log(globalVar); // âœ… è®¿é—®å…¨å±€ä½œç”¨åŸŸå˜é‡
    console.log(outerVar);  // âœ… è®¿é—®å¤–éƒ¨ä½œç”¨åŸŸå˜é‡
    console.log(innerVar);  // âœ… è®¿é—®è‡ªèº«ä½œç”¨åŸŸå˜é‡
  }

  inner();
}

outer();
```
ğŸ”¹ **ä½œç”¨åŸŸé“¾æŸ¥æ‰¾é¡ºåºï¼š**
1. å…ˆåœ¨ `inner()` å†…æŸ¥æ‰¾å˜é‡ã€‚
2. å¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±å¾€ `outer()` ä½œç”¨åŸŸæŸ¥æ‰¾ã€‚
3. å¦‚æœè¿˜æ‰¾ä¸åˆ°ï¼Œå°±å¾€ **å…¨å±€ä½œç”¨åŸŸ** æŸ¥æ‰¾ã€‚
4. æ‰¾ä¸åˆ°å°±æŠ¥é”™ `ReferenceError`ã€‚

---

### **5. å—çº§ä½œç”¨åŸŸ**
ES6 ä¹‹å‰ï¼ŒJavaScript åªæœ‰ **å‡½æ•°ä½œç”¨åŸŸï¼ˆFunction Scopeï¼‰**ï¼Œä½† ES6 å¼•å…¥äº† `let` å’Œ `const`ï¼Œæ”¯æŒ **å—çº§ä½œç”¨åŸŸï¼ˆBlock Scopeï¼‰**ã€‚

```javascript
{
  let x = 10;
  const y = 20;
}
console.log(x); // âŒ ReferenceError: x is not defined
console.log(y); // âŒ ReferenceError: y is not defined
```
ğŸ”¹ **ä½œç”¨åŸŸç±»å‹ï¼š**
- `var`ï¼š**å‡½æ•°ä½œç”¨åŸŸ**
- `let` / `const`ï¼š**å—çº§ä½œç”¨åŸŸ**
- `function`ï¼š**å‡½æ•°ä½œç”¨åŸŸ**
- `{}`ï¼ˆä»£ç å—ï¼‰ï¼š**å—çº§ä½œç”¨åŸŸï¼ˆä»… `let` å’Œ `const`ï¼‰**

---

### **6. é—­åŒ…ä¸è¯æ³•ä½œç”¨åŸŸ**
**é—­åŒ…ï¼ˆClosureï¼‰** æ˜¯ **å‡½æ•°å¯ä»¥â€œè®°ä½â€å…¶å®šä¹‰æ—¶çš„ä½œç”¨åŸŸï¼Œå³ä½¿å‡½æ•°åœ¨ä½œç”¨åŸŸå¤–è°ƒç”¨**ã€‚

```javascript
function outer() {
  let count = 0;

  return function inner() {
    count++;
    console.log(count);
  };
}

const counter = outer();
counter(); // è¾“å‡ºï¼š1
counter(); // è¾“å‡ºï¼š2
```
ğŸ”¹ `inner()` è®°ä½äº† `outer()` çš„ä½œç”¨åŸŸï¼Œå³ä½¿ `outer()` å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œ`count` ä»ç„¶ä¿ç•™åœ¨å†…å­˜ä¸­ã€‚è¿™å°±æ˜¯ **é—­åŒ…çš„ä½œç”¨**ï¼Œå®ƒä¾èµ–äº **è¯æ³•ä½œç”¨åŸŸ**ã€‚

---

### **7. è¯æ³•ä½œç”¨åŸŸæ€»ç»“**
âœ… **ä½œç”¨åŸŸåœ¨ä»£ç ç¼–å†™æ—¶å°±å·²ç¡®å®šï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶å†³å®š**ã€‚  
âœ… **å†…éƒ¨å‡½æ•°å¯ä»¥è®¿é—®å¤–éƒ¨ä½œç”¨åŸŸçš„å˜é‡ï¼ˆä½œç”¨åŸŸé“¾ï¼‰**ã€‚  
âœ… **JavaScript ä¸æ˜¯åŠ¨æ€ä½œç”¨åŸŸï¼Œè€Œæ˜¯è¯æ³•ä½œç”¨åŸŸ**ã€‚  
âœ… **é—­åŒ…ï¼ˆClosureï¼‰ä¾èµ–è¯æ³•ä½œç”¨åŸŸï¼Œä½¿å¾—å‡½æ•°å¯ä»¥è®°ä½åˆ›å»ºæ—¶çš„ä½œç”¨åŸŸ**ã€‚  

---

### **8. å¸¸è§é—®é¢˜**
#### **(1) ä¸‹é¢ä»£ç çš„è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ**
```javascript
var a = 10;
function test() {
  console.log(a);
  var a = 20;
}
test();
```
âœ… **è¾“å‡ºï¼š`undefined`**ï¼ˆä¸æ˜¯ `10`ï¼ï¼‰  
ğŸ”¹ **åŸå› **ï¼š  
- JavaScript å˜é‡æå‡ï¼ˆHoistingï¼‰ï¼š`var a` è¢«æå‡åˆ° `test()` ä½œç”¨åŸŸé¡¶éƒ¨ï¼Œé»˜è®¤ä¸º `undefined`ï¼Œä½†èµ‹å€¼ `20` å‘ç”Ÿåœ¨ `console.log(a)` ä¹‹åã€‚

ç­‰ä»·äºï¼š
```javascript
function test() {
  var a; // å˜é‡æå‡ï¼Œé»˜è®¤å€¼ `undefined`
  console.log(a); // undefined
  a = 20;
}
```

#### **(2) å¦‚ä½•è®© `setTimeout` å¾ªç¯æ­£ç¡®æ‰“å° `0, 1, 2, 3, 4`ï¼Ÿ**
```javascript
for (var i = 0; i < 5; i++) {
  setTimeout(() => console.log(i), 1000);
}
```
ğŸ”´ **é”™è¯¯è¾“å‡ºï¼š`5, 5, 5, 5, 5`**
- å› ä¸º `var` æ˜¯ **å‡½æ•°ä½œç”¨åŸŸ**ï¼Œå¾ªç¯ç»“æŸåï¼Œ`i` çš„å€¼æ˜¯ `5`ï¼Œæ‰€æœ‰ `setTimeout` å…±äº«åŒä¸€ä¸ª `i`ã€‚

âœ… **è§£å†³æ–¹æ³•ï¼šä½¿ç”¨ `let`**
```javascript
for (let i = 0; i < 5; i++) {
  setTimeout(() => console.log(i), 1000);
}
```
âœ… **æˆ–è€…ä½¿ç”¨é—­åŒ…**
```javascript
for (var i = 0; i < 5; i++) {
  (function (j) {
    setTimeout(() => console.log(j), 1000);
  })(i);
}
```

---

